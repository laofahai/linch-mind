# Linch Mind - ç”¨æˆ·æƒ…å¢ƒæ„ŸçŸ¥è¿æ¥å™¨é…ç½®
# é«˜æ€§èƒ½ç”¨æˆ·æƒ…å¢ƒæ„ŸçŸ¥è¿æ¥å™¨ï¼Œå®æ—¶ç›‘æ§ç”¨æˆ·æ´»åŠ¨ã€è®¾å¤‡çŠ¶æ€å’Œå·¥ä½œæ¨¡å¼

[metadata]
id = "user_context"
name = "ç”¨æˆ·æƒ…å¢ƒæ„ŸçŸ¥è¿æ¥å™¨"
version = "1.0.0"
author = "Linch Mind Team"
description = "äº‹ä»¶é©±åŠ¨çš„ç”¨æˆ·æƒ…å¢ƒæ„ŸçŸ¥è¿æ¥å™¨ï¼Œç›‘æ§å‰å°åº”ç”¨ã€è®¾å¤‡çŠ¶æ€ã€å·¥ä½œæ¨¡å¼ç­‰ç”¨æˆ·ç›¸å…³æ•°æ®"
homepage = "https://github.com/linch-mind/connectors/user_context"
license = "MIT"
category = "user_activity"
icon = "person"

# JSON Schema å¼•ç”¨
schema = "../../connector.schema.json"

[build]
build_command = "./build.sh"
pre_build = "echo 'Preparing Objective-C++ build environment'"
post_build = "echo 'User context build completed, event-driven monitoring ready'"

[capabilities]
hot_reload = true
max_instances = 1
supports_multiple_instances = false

# æƒé™è¦æ±‚ - ä¸“æ³¨ç”¨æˆ·è¡Œä¸ºç›‘æ§
permissions = [
    "accessibility:read",
    "applications:monitor",
    "windows:focus",
    "network:daemon-api"
]

# å¹³å°æ”¯æŒ
[platforms.linux]
min_version = "ubuntu-20.04"

[platforms.macos]
min_version = "10.15"

[platforms.windows]
min_version = "10"

# å…¥å£ç‚¹é…ç½®
[entry.development]
command = "bash"
working_dir = "."
args = [
    "-c",
    """# Smart build and run
exe_name='linch-mind-user-context'
[[ '$OSTYPE' == 'msys' || '$OSTYPE' == 'win32' ]] && exe_name='$exe_name.exe'

# Check if build is needed
if [[ ! -f "bin/release/$exe_name" && ! -f "bin/debug/$exe_name" ]] || [[ src/main.cpp -nt "bin/release/$exe_name" ]] || [[ src/main.cpp -nt "bin/debug/$exe_name" ]]; then
  echo 'ğŸ”¨ Building connector...'
  ./build.sh > /dev/null 2>&1 || { echo 'Build failed'; exit 1; }
fi

# Run the newest build
if [[ -f "bin/debug/$exe_name" ]]; then
  exec "./bin/debug/$exe_name"
elif [[ -f "bin/release/$exe_name" ]]; then
  exec "./bin/release/$exe_name"
else
  echo 'âŒ No executable found after build'
  exit 1
fi"""
]

[entry.production]
linux = "bin/release/linch-mind-user-context"
macos = "bin/release/linch-mind-user-context"
windows = "bin/release/linch-mind-user-context.exe"

# é»˜è®¤é…ç½®å€¼ - ä¸“æ³¨ç”¨æˆ·è¡Œä¸ºåˆ†æ
[config_default_values]
enable_app_monitoring = true       # å¯ç”¨å‰å°åº”ç”¨ç›‘æ§
enable_window_focus_tracking = true    # å¯ç”¨çª—å£ç„¦ç‚¹è·Ÿè¸ª
activity_summary_interval_hours = 2    # æ´»åŠ¨æ‘˜è¦ç”Ÿæˆé—´éš”ï¼ˆå°æ—¶ï¼‰
work_pattern_analysis = true       # å¯ç”¨å·¥ä½œæ¨¡å¼åˆ†æ
app_usage_tracking = true          # å¯ç”¨åº”ç”¨ä½¿ç”¨ç»Ÿè®¡
privacy_mode = "balanced"          # éšç§æ¨¡å¼: minimal, balanced, detailed
focus_session_detection = true     # å¯ç”¨ä¸“æ³¨ä¼šè¯æ£€æµ‹
productivity_metrics = true        # å¯ç”¨ç”Ÿäº§åŠ›æŒ‡æ ‡

# é…ç½®æ¨¡å¼å®šä¹‰
[config_schema]
description = "ç”¨æˆ·æƒ…å¢ƒæ„ŸçŸ¥è¿æ¥å™¨çš„é…ç½®é€‰é¡¹"
title = "ç”¨æˆ·æƒ…å¢ƒæ„ŸçŸ¥è¿æ¥å™¨é…ç½®"
type = "object"
config_schema_source = "static"

[config_schema.properties.enable_app_monitoring]
title = "å¯ç”¨åº”ç”¨ç›‘æ§"
description = "ç›‘æ§å‰å°åº”ç”¨åˆ‡æ¢å’Œä½¿ç”¨æ—¶é•¿"
type = "boolean"
default = true

[config_schema.properties.enable_window_focus_tracking]
title = "å¯ç”¨çª—å£ç„¦ç‚¹è·Ÿè¸ª"
description = "è·Ÿè¸ªçª—å£ç„¦ç‚¹å˜åŒ–ï¼Œåˆ†æå·¥ä½œåˆ‡æ¢æ¨¡å¼"
type = "boolean"
default = true

[config_schema.properties.activity_summary_interval_hours]
title = "æ´»åŠ¨æ‘˜è¦é—´éš” (å°æ—¶)"
description = "ç”Ÿæˆç”¨æˆ·æ´»åŠ¨æ¨¡å¼æ‘˜è¦çš„æ—¶é—´é—´éš”"
type = "integer"
minimum = 1
maximum = 24
default = 2

[config_schema.properties.work_pattern_analysis]
title = "å·¥ä½œæ¨¡å¼åˆ†æ"
description = "åˆ†æç”¨æˆ·çš„å·¥ä½œä¹ æƒ¯å’Œæ•ˆç‡æ¨¡å¼"
type = "boolean"
default = true

[config_schema.properties.app_usage_tracking]
title = "åº”ç”¨ä½¿ç”¨ç»Ÿè®¡"
description = "ç»Ÿè®¡å„åº”ç”¨çš„ä½¿ç”¨æ—¶é•¿å’Œé¢‘ç‡"
type = "boolean"
default = true

[config_schema.properties.focus_session_detection]
title = "ä¸“æ³¨ä¼šè¯æ£€æµ‹"
description = "æ£€æµ‹å’Œåˆ†æç”¨æˆ·çš„ä¸“æ³¨å·¥ä½œæ—¶æ®µ"
type = "boolean"
default = true

[config_schema.properties.productivity_metrics]
title = "ç”Ÿäº§åŠ›æŒ‡æ ‡"
description = "è®¡ç®—ç”Ÿäº§åŠ›ç›¸å…³çš„é‡åŒ–æŒ‡æ ‡"
type = "boolean"
default = true

[config_schema.properties.privacy_mode]
title = "éšç§æ¨¡å¼"
description = "æ•°æ®æ”¶é›†çš„éšç§çº§åˆ«"
type = "string"
enum = ["minimal", "balanced", "detailed"]
default = "balanced"

# å¿…éœ€é…ç½®å­—æ®µ
config_schema.required = []

# UIé…ç½®æ¨¡å¼
[config_ui_schema]
ui_layout = "sections"

# UIèŠ‚æ®µé…ç½®
[config_ui_schema.ui_sections.monitoring_config]
ui_title = "ç›‘æ§è®¾ç½®"
ui_icon = "monitor"
ui_description = "é…ç½®ç”¨æˆ·æƒ…å¢ƒæ„ŸçŸ¥çš„ç›‘æ§é€‰é¡¹"
ui_collapsible = false

[config_ui_schema.ui_sections.monitoring_config.ui_fields.enable_app_monitoring]
ui_widget = "switch"
ui_help = "ç›‘æ§å‰å°åº”ç”¨å˜åŒ–ï¼Œåˆ†æåº”ç”¨ä½¿ç”¨æ¨¡å¼"

[config_ui_schema.ui_sections.monitoring_config.ui_fields.enable_window_focus_tracking]
ui_widget = "switch"
ui_help = "è·Ÿè¸ªçª—å£ç„¦ç‚¹ï¼Œäº†è§£å·¥ä½œåˆ‡æ¢é¢‘ç‡"

[config_ui_schema.ui_sections.monitoring_config.ui_fields.work_pattern_analysis]
ui_widget = "switch"
ui_help = "åˆ†æå·¥ä½œä¹ æƒ¯ï¼Œè¯†åˆ«é«˜æ•ˆæ—¶æ®µ"

[config_ui_schema.ui_sections.monitoring_config.ui_fields.app_usage_tracking]
ui_widget = "switch"
ui_help = "ç»Ÿè®¡åº”ç”¨ä½¿ç”¨æ—¶é•¿ï¼Œä¼˜åŒ–å·¥ä½œæµç¨‹"

[config_ui_schema.ui_sections.monitoring_config.ui_fields.privacy_mode]
ui_widget = "select"
ui_help = "æ§åˆ¶æ•°æ®æ”¶é›†çš„è¯¦ç»†ç¨‹åº¦ï¼Œä¿æŠ¤ç”¨æˆ·éšç§"

[config_ui_schema.ui_sections.analysis_config]
ui_title = "åˆ†æé…ç½®"
ui_icon = "analytics"
ui_description = "é…ç½®ç”¨æˆ·è¡Œä¸ºåˆ†æå’Œç”Ÿäº§åŠ›æŒ‡æ ‡"
ui_collapsed = false
ui_collapsible = true

[config_ui_schema.ui_sections.analysis_config.ui_fields.focus_session_detection]
ui_widget = "switch"
ui_help = "æ£€æµ‹ä¸“æ³¨å·¥ä½œæ—¶æ®µï¼Œæä¾›æ•ˆç‡æ”¹è¿›å»ºè®®"

[config_ui_schema.ui_sections.analysis_config.ui_fields.productivity_metrics]
ui_widget = "switch"
ui_help = "è®¡ç®—ç”Ÿäº§åŠ›æŒ‡æ ‡ï¼Œé‡åŒ–å·¥ä½œæ•ˆç‡"

[config_ui_schema.ui_sections.analysis_config.ui_fields.activity_summary_interval_hours]
ui_widget = "slider"
ui_step = 1
ui_unit = "å°æ—¶"
ui_help = "å®šæœŸç”Ÿæˆç”¨æˆ·æ´»åŠ¨æ¨¡å¼æ‘˜è¦"