# Linch Mind - å‰ªè´´æ¿è¿æ¥å™¨é…ç½®
# é«˜æ€§èƒ½C++å‰ªè´´æ¿ç›‘æ§è¿æ¥å™¨ï¼Œå®æ—¶æ•è·å‰ªè´´æ¿å†…å®¹å˜åŒ–

[metadata]
id = "clipboard"
name = "å‰ªè´´æ¿è¿æ¥å™¨"
version = "0.1.1" 
author = "Linch Mind Team"
description = "é«˜æ€§èƒ½C++å‰ªè´´æ¿ç›‘æ§è¿æ¥å™¨ï¼Œå®æ—¶æ•è·å‰ªè´´æ¿å†…å®¹å¹¶å»ºç«‹æ™ºèƒ½å…³è”"
homepage = "https://github.com/linch-mind/connectors/clipboard"
license = "MIT"
category = "system_integration"
icon = "content_paste"

# JSON Schema å¼•ç”¨
schema = "../../connector.schema.json"

[build]
build_command = "./build.sh"
pre_build = "echo 'Preparing C++ clipboard monitoring build'"
post_build = "echo 'Clipboard connector build completed'"

[capabilities]
hot_reload = true
max_instances = 1  # å‰ªè´´æ¿è¿æ¥å™¨åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹
supports_multiple_instances = false

# æƒé™è¦æ±‚
permissions = [
    "system:clipboard:read",
    "network:daemon-api"
]

# å¹³å°æ”¯æŒ
[platforms.linux]
min_version = "ubuntu-20.04"

[platforms.macos] 
min_version = "10.15"

[platforms.windows]
min_version = "10"

# å…¥å£ç‚¹é…ç½®
[entry.development]
command = "bash"
working_dir = "."
args = [
    "-c",
    """# Smart build and run for clipboard
exe_name='linch-mind-clipboard'
[[ '$OSTYPE' == 'msys' || '$OSTYPE' == 'win32' ]] && exe_name='$exe_name.exe'

# Check if build is needed
if [[ ! -f "bin/release/$exe_name" && ! -f "bin/debug/$exe_name" ]] || [[ src/main.cpp -nt "bin/release/$exe_name" ]] || [[ src/main.cpp -nt "bin/debug/$exe_name" ]]; then
  echo 'ğŸ”¨ Building clipboard connector...'
  ./build.sh > /dev/null 2>&1 || { echo 'Build failed'; exit 1; }
fi

# Run the newest build
if [[ -f "bin/debug/$exe_name" ]]; then
  exec "./bin/debug/$exe_name"
elif [[ -f "bin/release/$exe_name" ]]; then
  exec "./bin/release/$exe_name"
else
  echo 'âŒ No clipboard executable found after build'
  exit 1
fi"""
]

[entry.production]
linux = "bin/release/linch-mind-clipboard"
macos = "bin/release/linch-mind-clipboard"
windows = "bin/release/linch-mind-clipboard.exe"

# é»˜è®¤é…ç½®å€¼
[config_default_values]
monitor_interval = 0.5      # å‰ªè´´æ¿æ£€æŸ¥é—´éš”(ç§’)
max_content_length = 10000  # æœ€å¤§å†…å®¹é•¿åº¦
enable_text_analysis = true # å¯ç”¨æ–‡æœ¬åˆ†æ
enable_url_extraction = true # URLæå–
enable_file_path_detection = true # æ–‡ä»¶è·¯å¾„æ£€æµ‹
history_retention_hours = 24 # å†å²è®°å½•ä¿ç•™æ—¶é—´(å°æ—¶)
ignore_duplicate_interval = 2.0 # å¿½ç•¥é‡å¤å†…å®¹çš„æ—¶é—´é—´éš”(ç§’)

# å†…å®¹ç±»å‹è¿‡æ»¤
content_types = ["text", "url", "file_path", "image_path"]
ignore_patterns = [
    "^\\s*$",           # ç©ºç™½å†…å®¹
    "^.{1,2}$",         # è¿‡çŸ­å†…å®¹
    "password",         # åŒ…å«å¯†ç çš„å†…å®¹
    "secret",           # åŒ…å«å¯†é’¥çš„å†…å®¹
    "token"             # åŒ…å«tokençš„å†…å®¹
]

# é…ç½®æ¨¡å¼å®šä¹‰
[config_schema]
description = "å‰ªè´´æ¿ç›‘æ§è¿æ¥å™¨çš„é…ç½®é€‰é¡¹"
title = "å‰ªè´´æ¿è¿æ¥å™¨é…ç½®"
type = "object"
config_schema_source = "static"

[config_schema.properties.monitor_interval]
title = "ç›‘æ§é—´éš” (ç§’)"
description = "å‰ªè´´æ¿å†…å®¹æ£€æŸ¥é¢‘ç‡"
type = "number"
minimum = 0.1
maximum = 5.0
default = 0.5

[config_schema.properties.max_content_length]
title = "æœ€å¤§å†…å®¹é•¿åº¦"
description = "å‰ªè´´æ¿å†…å®¹çš„æœ€å¤§å­—ç¬¦æ•°"
type = "integer"
minimum = 100
maximum = 50000
default = 10000

[config_schema.properties.enable_text_analysis]
title = "å¯ç”¨æ–‡æœ¬åˆ†æ"
description = "å¯¹å‰ªè´´æ¿æ–‡æœ¬å†…å®¹è¿›è¡Œæ™ºèƒ½åˆ†æ"
type = "boolean"
default = true

[config_schema.properties.enable_url_extraction]
title = "å¯ç”¨URLæå–"
description = "è‡ªåŠ¨è¯†åˆ«å’Œæå–URLé“¾æ¥"
type = "boolean"
default = true

[config_schema.properties.enable_file_path_detection]
title = "å¯ç”¨æ–‡ä»¶è·¯å¾„æ£€æµ‹"
description = "è‡ªåŠ¨è¯†åˆ«æ–‡ä»¶è·¯å¾„"
type = "boolean"
default = true

[config_schema.properties.history_retention_hours]
title = "å†å²ä¿ç•™æ—¶é—´ (å°æ—¶)"
description = "å‰ªè´´æ¿å†å²è®°å½•ä¿ç•™æ—¶é•¿"
type = "integer"
minimum = 1
maximum = 168  # 7å¤©
default = 24

[config_schema.properties.ignore_duplicate_interval]
title = "å¿½ç•¥é‡å¤é—´éš” (ç§’)"
description = "çŸ­æ—¶é—´å†…çš„é‡å¤å†…å®¹å°†è¢«å¿½ç•¥"
type = "number"
minimum = 0.5
maximum = 10.0
default = 2.0

[config_schema.properties.content_types]
title = "å†…å®¹ç±»å‹"
description = "è¦ç›‘æ§çš„å‰ªè´´æ¿å†…å®¹ç±»å‹"
type = "array"
default = ["text", "url", "file_path", "image_path"]

[config_schema.properties.content_types.items]
type = "string"
enum = ["text", "url", "file_path", "image_path", "rich_text"]

[config_schema.properties.ignore_patterns]
title = "å¿½ç•¥æ¨¡å¼"
description = "åŒ¹é…è¿™äº›æ­£åˆ™è¡¨è¾¾å¼çš„å†…å®¹å°†è¢«å¿½ç•¥"
type = "array"
default = ["^\\s*$", "^.{1,2}$", "password", "secret", "token"]

[config_schema.properties.ignore_patterns.items]
type = "string"

# å¿…éœ€é…ç½®å­—æ®µ
config_schema.required = ["monitor_interval", "max_content_length"]

# UIé…ç½®æ¨¡å¼
[config_ui_schema]
ui_layout = "sections"

# UIèŠ‚æ®µé…ç½®
[config_ui_schema.ui_sections.basic_config]
ui_title = "åŸºç¡€è®¾ç½®"
ui_icon = "content_paste"
ui_description = "å‰ªè´´æ¿ç›‘æ§çš„åŸºæœ¬é…ç½®"
ui_collapsible = false

[config_ui_schema.ui_sections.basic_config.ui_fields.monitor_interval]
ui_widget = "slider"
ui_step = 0.1
ui_unit = "ç§’"
ui_help = "æ£€æŸ¥é¢‘ç‡ï¼Œè¿‡ä½å¯èƒ½å½±å“ç³»ç»Ÿæ€§èƒ½"

[config_ui_schema.ui_sections.basic_config.ui_fields.max_content_length]
ui_widget = "slider"
ui_step = 1000
ui_unit = "å­—ç¬¦"
ui_help = "è¶…è¿‡æ­¤é•¿åº¦çš„å†…å®¹å°†è¢«æˆªæ–­"

[config_ui_schema.ui_sections.basic_config.ui_fields.history_retention_hours]
ui_widget = "slider"
ui_step = 1
ui_unit = "å°æ—¶"
ui_help = "å†å²è®°å½•ä¿ç•™æ—¶é—´ï¼Œè¿‡é•¿å¯èƒ½å ç”¨æ›´å¤šå­˜å‚¨"

[config_ui_schema.ui_sections.analysis_config]
ui_title = "å†…å®¹åˆ†æ"
ui_icon = "analytics"
ui_description = "å‰ªè´´æ¿å†…å®¹çš„æ™ºèƒ½åˆ†æé€‰é¡¹"
ui_collapsed = false
ui_collapsible = true

[config_ui_schema.ui_sections.analysis_config.ui_fields.enable_text_analysis]
ui_widget = "switch"
ui_help = "å¯¹æ–‡æœ¬å†…å®¹è¿›è¡Œæ™ºèƒ½åˆ†æå’Œåˆ†ç±»"

[config_ui_schema.ui_sections.analysis_config.ui_fields.enable_url_extraction]
ui_widget = "switch"
ui_help = "è‡ªåŠ¨è¯†åˆ«URLå¹¶æå–å…ƒä¿¡æ¯"

[config_ui_schema.ui_sections.analysis_config.ui_fields.enable_file_path_detection]
ui_widget = "switch"
ui_help = "è¯†åˆ«æ–‡ä»¶è·¯å¾„å¹¶å…³è”æ–‡ä»¶ç³»ç»Ÿ"

[config_ui_schema.ui_sections.analysis_config.ui_fields.content_types]
ui_widget = "checkbox_group"
ui_help = "é€‰æ‹©è¦ç›‘æ§çš„å‰ªè´´æ¿å†…å®¹ç±»å‹"

[config_ui_schema.ui_sections.filter_config]
ui_title = "è¿‡æ»¤è®¾ç½®"
ui_icon = "filter_alt"
ui_description = "é…ç½®è¦å¿½ç•¥çš„å†…å®¹æ¨¡å¼"
ui_collapsed = true
ui_collapsible = true

[config_ui_schema.ui_sections.filter_config.ui_fields.ignore_duplicate_interval]
ui_widget = "slider"
ui_step = 0.5
ui_unit = "ç§’"
ui_help = "çŸ­æ—¶é—´å†…çš„é‡å¤å†…å®¹å°†è¢«å¿½ç•¥"

[config_ui_schema.ui_sections.filter_config.ui_fields.ignore_patterns]
ui_widget = "tag_input"
ui_placeholder = "è¾“å…¥æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼"
ui_help = "åŒ¹é…çš„å†…å®¹å°†è¢«å¿½ç•¥ï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼"