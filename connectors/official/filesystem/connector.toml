# Linch Mind - æ–‡ä»¶ç³»ç»Ÿè¿æ¥å™¨é…ç½®
# é«˜æ€§èƒ½C++æ–‡ä»¶ç³»ç»Ÿç›‘æ§è¿æ¥å™¨ï¼Œå®æ—¶ç›‘æ§æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨è®°å½•å’Œç´¢å¼•æ–‡ä»¶å†…å®¹

[metadata]
id = "filesystem"
name = "æ–‡ä»¶ç³»ç»Ÿè¿æ¥å™¨"
version = "0.1.1"
author = "Linch Mind Team"
description = "é«˜æ€§èƒ½C++ç‰ˆæœ¬æ–‡ä»¶ç³»ç»Ÿç›‘æ§è¿æ¥å™¨ï¼Œå®æ—¶ç›‘æ§æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨è®°å½•å’Œç´¢å¼•æ–‡ä»¶å†…å®¹"
homepage = "https://github.com/linch-mind/connectors/filesystem"
license = "MIT"
category = "local_files"
icon = "folder"

# JSON Schema å¼•ç”¨
schema = "../../connector.schema.json"

[build]
build_command = "./build.sh"
pre_build = "echo 'Preparing C++ build environment'"
post_build = "echo 'C++ build completed, binary size optimized'"

[capabilities]
hot_reload = true
max_instances = 10
supports_multiple_instances = true

# æƒé™è¦æ±‚
permissions = [
    "filesystem:read",
    "filesystem:watch", 
    "network:daemon-api"
]

# å¹³å°æ”¯æŒ
[platforms.linux]
min_version = "ubuntu-20.04"

[platforms.macos]
min_version = "10.15"

[platforms.windows]
min_version = "10"

# å…¥å£ç‚¹é…ç½®
[entry.development]
command = "bash"
working_dir = "."
args = [
    "-c",
    """# Smart build and run
exe_name='linch-mind-filesystem'
[[ '$OSTYPE' == 'msys' || '$OSTYPE' == 'win32' ]] && exe_name='$exe_name.exe'

# Check if build is needed
if [[ ! -f "bin/release/$exe_name" && ! -f "bin/debug/$exe_name" ]] || [[ src/main.cpp -nt "bin/release/$exe_name" ]] || [[ src/main.cpp -nt "bin/debug/$exe_name" ]]; then
  echo 'ğŸ”¨ Building connector...'
  ./build.sh > /dev/null 2>&1 || { echo 'Build failed'; exit 1; }
fi

# Run the newest build
if [[ -f "bin/debug/$exe_name" ]]; then
  exec "./bin/debug/$exe_name"
elif [[ -f "bin/release/$exe_name" ]]; then
  exec "./bin/release/$exe_name"
else
  echo 'âŒ No executable found after build'
  exit 1
fi"""
]

[entry.production]
linux = "bin/release/linch-mind-filesystem"
macos = "bin/release/linch-mind-filesystem"
windows = "bin/release/linch-mind-filesystem.exe"

# é»˜è®¤é…ç½®å€¼
[config_default_values]
watch_directories = ["/Users/laofahai/Documents/linch_test"]  # æ ¹æœ¬ä¿®å¤ï¼šé¿å¼€å˜ˆæ‚çš„/tmpç›®å½•
recursive_depth = 3  # å‡å°‘é€’å½’æ·±åº¦ï¼Œå‡å°‘ç›‘æ§èŒƒå›´
max_file_size = 10   # å‡å°æ–‡ä»¶å¤§å°é™åˆ¶åˆ° 10MB
max_content_length = 10000  # å‡å°å†…å®¹é•¿åº¦
batch_interval = 6000  # å¢åŠ åˆ° 6 ç§’æ‰¹é‡é—´éš”ï¼Œé…åˆFSEvents 5ç§’å»¶è¿Ÿ
debounce_time = 5000   # è°ƒæ•´åˆ° 5 ç§’å»é‡æ—¶é—´ï¼Œä¸FSEventsåŒæ­¥
include_extensions = [
    ".txt", ".md", ".pdf", ".doc", ".docx", 
    ".xls", ".xlsx", ".ppt", ".pptx"
]
exclude_patterns = [
    "^\\..*",         # éšè—æ–‡ä»¶
    ".*\\.tmp$",      # ä¸´æ—¶æ–‡ä»¶
    ".*\\.log$",      # æ—¥å¿—æ–‡ä»¶
    ".*\\.cache$",    # ç¼“å­˜æ–‡ä»¶
    ".*~$",          # å¤‡ä»½æ–‡ä»¶
    ".*\\.swp$",      # Vimäº¤æ¢æ–‡ä»¶
    ".*\\.bak$",      # å¤‡ä»½æ–‡ä»¶
    "__pycache__",    # Pythonç¼“å­˜
    "node_modules",   # Node.jsæ¨¡å—
    "\\.git",          # Gitç›®å½•
    "\\.vscode",       # VS Codeé…ç½®
    "\\.idea",         # IntelliJ IDEAé…ç½®
    "dist",           # æ„å»ºè¾“å‡º
    "build",          # æ„å»ºç›®å½•
    "\\.DS_Store",     # macOSç³»ç»Ÿæ–‡ä»¶
    "Thumbs.db"       # Windowsç¼©ç•¥å›¾
]
enable_content_indexing = true

# å¿«é€Ÿç´¢å¼•é…ç½®
enable_fast_indexing = true        # å¯ç”¨å¿«é€Ÿç´¢å¼•ï¼ˆç±»ä¼¼Everythingï¼‰
fast_index_mode = "hybrid"         # ç´¢å¼•æ¨¡å¼: fast_only, deep_only, hybrid
fast_index_batch_size = 1000       # æ‰¹å¤„ç†å¤§å°
fast_index_batch_interval = 200    # æ‰¹å¤„ç†é—´éš”(æ¯«ç§’)
fast_index_memory_limit = 100      # å†…å­˜é™åˆ¶(MB)
fast_index_progress_report = true  # å¯ç”¨è¿›åº¦æŠ¥å‘Š

# é…ç½®æ¨¡å¼å®šä¹‰
[config_schema]
description = "é«˜æ€§èƒ½æ–‡ä»¶ç³»ç»Ÿç›‘æ§è¿æ¥å™¨çš„é…ç½®é€‰é¡¹"
title = "æ–‡ä»¶ç³»ç»Ÿè¿æ¥å™¨é…ç½®"
type = "object"
config_schema_source = "static"

[config_schema.properties.watch_directories]
title = "ç›‘æ§ç›®å½•"
description = "è¦ç›‘æ§çš„ç›®å½•è·¯å¾„åˆ—è¡¨"
type = "array"
min_items = 1
default = ["/tmp/linch_test"]

[config_schema.properties.watch_directories.items]
type = "string"

[config_schema.properties.batch_interval]
title = "æ‰¹é‡å¤„ç†é—´éš” (æ¯«ç§’)"
description = "èšåˆæ–‡ä»¶äº‹ä»¶çš„æ—¶é—´é—´éš”ï¼Œå‡å°‘ç½‘ç»œè°ƒç”¨"
type = "integer"
minimum = 100
maximum = 10000
default = 6000

[config_schema.properties.debounce_time]
title = "äº‹ä»¶å»é‡æ—¶é—´ (æ¯«ç§’)"
description = "åŒä¸€æ–‡ä»¶çš„é‡å¤äº‹ä»¶å»é‡æ—¶é—´"
type = "integer"
minimum = 100
maximum = 10000
default = 5000

[config_schema.properties.recursive_depth]
title = "é€’å½’æ·±åº¦"
description = "å­ç›®å½•æ‰«æçš„æœ€å¤§æ·±åº¦"
type = "integer"
minimum = 1
maximum = 20
default = 5

[config_schema.properties.max_file_size]
title = "æœ€å¤§æ–‡ä»¶å¤§å° (MB)"
description = "è¶…è¿‡æ­¤å¤§å°çš„æ–‡ä»¶å°†è¢«å¿½ç•¥"
type = "integer"
minimum = 1
maximum = 1000
default = 50

[config_schema.properties.include_extensions]
title = "åŒ…å«çš„æ–‡ä»¶æ‰©å±•å"
description = "åªç›‘æ§è¿™äº›æ‰©å±•åçš„æ–‡ä»¶"
type = "array"
default = [".txt", ".md", ".pdf", ".doc", ".docx", ".xls", ".xlsx", ".ppt", ".pptx"]

[config_schema.properties.include_extensions.items]
type = "string"

[config_schema.properties.exclude_patterns]
title = "æ’é™¤æ¨¡å¼"
description = "æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼ŒåŒ¹é…çš„æ–‡ä»¶å°†è¢«å¿½ç•¥"
type = "array"
default = ["^\\..*", ".*\\.tmp$", ".*\\.log$", "__pycache__", "node_modules"]

[config_schema.properties.exclude_patterns.items]
type = "string"

[config_schema.properties.max_content_length]
title = "æœ€å¤§å†…å®¹é•¿åº¦"
description = "æ–‡ä»¶å†…å®¹æˆªæ–­é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰"
type = "integer"
minimum = 1000
maximum = 200000
default = 50000

[config_schema.properties.enable_content_indexing]
title = "å¯ç”¨å†…å®¹ç´¢å¼•"
description = "æ˜¯å¦ç´¢å¼•æ–‡ä»¶å†…å®¹ç”¨äºæœç´¢"
type = "boolean"
default = true

# å¿…éœ€é…ç½®å­—æ®µ
config_schema.required = ["watch_directories"]

# UIé…ç½®æ¨¡å¼
[config_ui_schema]
ui_layout = "sections"

# UIèŠ‚æ®µé…ç½®
[config_ui_schema.ui_sections.basic_config]
ui_title = "åŸºç¡€è®¾ç½®"
ui_icon = "folder"
ui_description = "æ–‡ä»¶ç³»ç»Ÿç›‘æ§çš„åŸºæœ¬é…ç½®"
ui_collapsible = false

[config_ui_schema.ui_sections.basic_config.ui_fields.watch_directories]
ui_widget = "directory_picker"
ui_multiple = true
ui_help = "å¯ä»¥æ·»åŠ å¤šä¸ªç›®å½•è¿›è¡Œç›‘æ§ï¼Œæ”¯æŒ ~ ç¬¦å·"

[config_ui_schema.ui_sections.basic_config.ui_fields.batch_interval]
ui_widget = "slider"
ui_step = 50
ui_unit = "æ¯«ç§’"
ui_help = "èšåˆäº‹ä»¶é—´éš”ï¼Œè¾ƒå°å€¼å“åº”æ›´å¿«ä½†ç½‘ç»œè°ƒç”¨æ›´é¢‘ç¹"

[config_ui_schema.ui_sections.basic_config.ui_fields.debounce_time]
ui_widget = "slider"
ui_step = 50
ui_unit = "æ¯«ç§’"
ui_help = "å»é‡æ—¶é—´ï¼Œé¿å…åŒä¸€æ–‡ä»¶çš„é‡å¤äº‹ä»¶"

[config_ui_schema.ui_sections.basic_config.ui_fields.recursive_depth]
ui_widget = "slider"
ui_step = 1
ui_unit = "å±‚"
ui_help = "æ·±å±‚ç›®å½•æ‰«æå¯èƒ½å½±å“æ€§èƒ½"

[config_ui_schema.ui_sections.filter_config]
ui_title = "æ–‡ä»¶è¿‡æ»¤"
ui_icon = "filter_alt"
ui_description = "é…ç½®è¦ç›‘æ§å’Œå¿½ç•¥çš„æ–‡ä»¶ç±»å‹"
ui_collapsed = false
ui_collapsible = true

[config_ui_schema.ui_sections.filter_config.ui_fields.include_extensions]
ui_widget = "tag_input"
ui_placeholder = "è¾“å…¥æ‰©å±•åï¼Œå¦‚ .txt"
ui_help = "åªç›‘æ§æŒ‡å®šæ‰©å±•åçš„æ–‡ä»¶"

[config_ui_schema.ui_sections.filter_config.ui_fields.exclude_patterns]
ui_widget = "tag_input"
ui_placeholder = "è¾“å…¥æ’é™¤æ¨¡å¼"
ui_help = "æ­£åˆ™è¡¨è¾¾å¼ï¼ŒåŒ¹é…çš„æ–‡ä»¶å°†è¢«å¿½ç•¥"

[config_ui_schema.ui_sections.filter_config.ui_fields.max_file_size]
ui_widget = "slider"
ui_step = 5
ui_unit = "MB"
ui_help = "å¤§æ–‡ä»¶é€šå¸¸å¤„ç†è€—æ—¶ï¼Œå»ºè®®è®¾ç½®åˆç†ä¸Šé™"

[config_ui_schema.ui_sections.advanced_config]
ui_title = "é«˜çº§é€‰é¡¹"
ui_icon = "settings"
ui_description = "é«˜çº§ç´¢å¼•é€‰é¡¹"
ui_collapsed = true
ui_collapsible = true

[config_ui_schema.ui_sections.advanced_config.ui_fields.max_content_length]
ui_widget = "slider"
ui_step = 5000
ui_unit = "å­—ç¬¦"
ui_help = "å•ä¸ªæ–‡ä»¶å†…å®¹çš„æœ€å¤§å­—ç¬¦æ•°ï¼Œè¶…è¿‡å°†è¢«æˆªæ–­"

[config_ui_schema.ui_sections.advanced_config.ui_fields.enable_content_indexing]
ui_widget = "switch"
ui_help = "ç´¢å¼•æ–‡ä»¶å†…å®¹ç”¨äºæœç´¢ï¼Œä½†ä¼šæ¶ˆè€—æ›´å¤šèµ„æº"