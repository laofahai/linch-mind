# Linch Mind 项目开发上下文

## 💀 开发强制要求

⚠️ **警告：以下为绝对强制要求，任何违反将导致严重后果**

### 🚫 技术架构铁律（违反者承担全部责任）
**绝对禁止事项**：
1. **IPC通信红线**：🚫 **严禁**引入任何HTTP/REST API通信方式
2. **依赖管理红线**：🚫 **严禁**使用pip/conda，必须使用Poetry管理
3. **性能底线**：🚫 **严禁**接受IPC延迟>10ms的任何实现
4. **架构污染**：🚫 **严禁**在IPC架构中混合HTTP组件

### ⚔️ Sub-agent咨询铁律（违反=项目风险）

#### ⚡ 强制咨询场景（无例外）
- **core-development-architect**：任何涉及>3个文件的修改
- **ui-ux-specialist**：任何Flutter界面变更
- **data-architecture-specialist**：任何数据库结构调整
- **test-specialist**：任何新功能开发必须配套测试
- **project-docs-manager**：任何架构变更必须同步文档

#### 🔴 违规等级与后果
- **S级违规**（架构破坏）：立即停止，回滚所有变更
- **A级违规**（跳过必要咨询）：重新设计，延长开发周期
- **B级违规**（流程不当）：补充必要步骤，记录警告

### 🛡️ 开发检查点制度

#### 💀 每次开发前强制确认
1. **架构影响评估**：是否破坏IPC架构完整性？
2. **性能影响评估**：是否影响<5ms IPC通信性能？  
3. **依赖冲突评估**：是否引入非Poetry管理的包？
4. **专业度评估**：是否需要专业Sub-agent支持？

#### ⚡ 违规自动检测机制
- 代码扫描检测HTTP残留引用
- 性能基准测试检测延迟回归
- 依赖分析检测非Poetry包
- 文档同步检测架构偏离

### 🎯 开发优先级军规
1. **紧急**：影响用户核心功能的P0问题（立即处理）
2. **重要**：架构稳定性和性能回归（24小时内）
3. **常规**：功能增强和用户体验改进（按计划）
4. **维护**：技术债务和代码优化（定期处理）

### ⚠️ 问责与改进机制
- 每次违规记录原因分析和改进措施
- 重复违规将触发流程review和加强培训
- 严重违规将要求architectural decision record (ADR)

## 项目概览
- **项目名称**: Linch Mind - 个人AI生活助手
- **核心定位**: 跨应用智能连接器 + 主动推荐引擎 + 个人数据洞察平台
- **当前阶段**: IPC架构的高性能本地服务
- **核心架构**: Flutter + Python IPC Daemon + C++连接器
- **技术栈**: Flutter (跨平台UI), Python IPC (后端服务), SQLite, FAISS

## 🏗️ 系统架构

### IPC架构设计
```
┌─────────────────────────────────────────┐
│           Flutter 跨平台UI               │
│  - 智能推荐界面                          │
│  - AI对话交互                            │
│  - 系统状态监控                          │
├─────────────────────────────────────────┤
│        Python IPC Daemon               │
│  - IPC服务器 (Unix Socket/Named Pipe)   │
│  - 智能推荐引擎 (NetworkX + FAISS)      │
│  - 数据服务 (SQLAlchemy + SQLite)       │
│  - 连接器管理                            │
├─────────────────────────────────────────┤
│          C++ 连接器生态                   │
│  - 文件系统连接器                        │
│  - 剪贴板连接器                          │
│  - 未来扩展连接器                        │
└─────────────────────────────────────────┘
```

## 当前技术现状
### ✅ 已实现的基础设施
1. **Python IPC Daemon**: 纯IPC架构 + SQLite存储
2. **连接器系统**: 文件系统、剪贴板连接器 (C++)
3. **数据处理**: 知识图谱 + 向量搜索 + 智能推荐
4. **Flutter UI**: 跨平台界面 + IPC通信
5. **系统管理**: 统一启动脚本 + 进程管理

## 🎯 开发重点

### 当前状态
- **架构迁移**: 已完成HTTP到IPC架构的完整迁移
- **数据真实化**: 知识图谱和推荐系统完全基于真实数据
- **性能优化**: IPC通信延迟<5ms，大幅提升响应速度
- **系统稳定**: 统一启动脚本，自动化连接器管理

### 下阶段计划
- **AI服务集成**: 集成多种AI提供者API
- **用户体验优化**: 改进推荐算法和界面交互
- **连接器扩展**: 开发更多数据源连接器
- **跨平台适配**: 优化移动端和Web端体验

## 🔧 开发环境

### 🚀 项目启动
```bash
# 启动完整应用
./linch-mind start

# 分步启动
./linch-mind daemon start  # 后台服务
./linch-mind ui            # UI界面
./linch-mind status        # 系统状态
```

### 技术栈
- **后端**: Python 3.13+ + IPC + SQLAlchemy + SQLite
- **前端**: Flutter 3.32+ + Riverpod 
- **连接器**: C++ + CMake
- **依赖管理**: Poetry

## 📋 重要决策记录

### IPC架构迁移 (2025-08-07)
**决策**: 从 HTTP REST API 迁移到纯IPC架构
**理由**: 
- 性能提升: 延迟降低90%+, RPS提升10倍
- 安全增强: 零网络暴露风险
- 简化部署: 无端口冲突和防火墙配置
**影响**: API客户端改为IPC通信，向后兼容

---

## 🔍 开发指南

### 基本流程
1. 工作前检查：影响范围、技术风险、测试要求
2. Sub-agent咨询：根据修改类型选择相应专家
3. 实现开发：遵循IPC架构原则
4. 测试验证：确保功能正常运行
5. 文档更新：同步更新相关文档

### 🔒 技术架构铁律与强制约束

#### 💀 IPC通信架构铁律
- **绝对强制**：所有daemon-ui通信必须使用Unix Socket/Named Pipe
- **绝对禁止**：HTTP REST API、WebSocket、TCP Socket等网络协议
- **实现状态**：Unix Socket已完成，Windows Named Pipe开发中
- **性能目标**：IPC延迟<5ms，RPS>10,000（待基准测试验证）
- **错误处理**：IPC断线必须有自动重连机制

#### 💀 依赖管理铁律  
- **绝对强制**：Python依赖必须使用Poetry管理（pyproject.toml）
- **绝对禁止**：pip install、conda install、requirements.txt
- **版本锁定**：所有依赖必须有明确版本范围约束
- **安全审计**：新依赖必须通过safety check扫描

#### 💀 构建工具链铁律
- **C++连接器**：必须使用CMake构建，禁止手动编译
- **Flutter UI**：必须使用Riverpod状态管理，禁止setState等原始方式
- **Python服务**：必须使用SQLAlchemy ORM，禁止原始SQL
- **向量搜索**：必须使用FAISS索引，禁止暴力搜索算法

#### 💀 性能与质量铁律
- **启动时间**：应用冷启动必须<3s，热启动<1s
- **内存使用**：Daemon峰值内存<500MB，UI<200MB  
- **测试覆盖**：新功能代码覆盖率必须>80%
- **文档同步**：架构变更必须同步更新文档，延迟不得>24小时

---

*版本: v9.0 | 创建时间: 2025-07-25 | 最后更新: 2025-08-08*  
*💀 重大更新: 强化开发约束，军事化管理语气 + 技术架构铁律*  
*⚔️ 安全机制: 违规等级制度 + 自动检测机制 + 问责改进流程*