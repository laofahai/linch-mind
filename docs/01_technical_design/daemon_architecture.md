# Linch Mind Python Daemon æ¶æ„è®¾è®¡

**ç‰ˆæœ¬**: 5.0
**çŠ¶æ€**: å·²å®ç° + P0é‡æ„å®Œæˆ + ç¯å¢ƒéš”ç¦»å®Œæˆ
**åˆ›å»ºæ—¶é—´**: 2025-08-03
**æœ€æ–°æ›´æ–°**: 2025-08-11
**æŠ€æœ¯æ ˆ**: çº¯IPCæ¶æ„ + SQLAlchemy + SQLite + ç°ä»£åŒ–æœåŠ¡æ¶æ„ + ç¯å¢ƒéš”ç¦»ç®¡ç†

## ğŸš€ é‡å¤§æ¶æ„å‡çº§

### v5.0 - ç¯å¢ƒéš”ç¦»ç³»ç»Ÿ (2025-08-11)
**å®Œæ•´ç¯å¢ƒç®¡ç†**: å®æ–½å®Œæ•´çš„ç¯å¢ƒéš”ç¦»å’Œç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒdevelopment/staging/productionç¯å¢ƒ
- **ç¯å¢ƒéš”ç¦»**: å®Œå…¨ç‹¬ç«‹çš„ç¯å¢ƒæ•°æ®ç›®å½• ~/.linch-mind/{env}/
- **æ•°æ®åº“éš”ç¦»**: ç¯å¢ƒä¸“ç”¨æ•°æ®åº“ï¼Œç”Ÿäº§ç¯å¢ƒSQLCipheråŠ å¯†
- **é…ç½®ç»§æ‰¿**: æ™ºèƒ½é…ç½®åˆå¹¶ (é»˜è®¤ + ç¯å¢ƒ + æ•°æ®åº“)
- **è‡ªåŠ¨åˆå§‹åŒ–**: ä¸€é”®ç¯å¢ƒè®¾ç½®å’Œå¥åº·æ£€æŸ¥ ./linch-mind init
- **é›¶ç ´åæ€§**: å‘åå…¼å®¹ï¼Œæ— ä»»ä½•Breaking Changes

### v4.0 - P0ä»£ç é‡å¤æ¶ˆé™¤é‡æ„ (2025-08-08)
**ç°ä»£åŒ–æœåŠ¡æ¶æ„**: å®Œæˆä»£ç é‡å¤æ¶ˆé™¤å’Œæ¶æ„ç°ä»£åŒ–é‡æ„ï¼Œä»£ç é‡å¤ç‡ä»>60%é™è‡³<5%
- **ServiceFacadeç³»ç»Ÿ**: ç»Ÿä¸€æœåŠ¡è·å–ï¼Œæ›¿ä»£91ä¸ªé‡å¤get_*_service()è°ƒç”¨
- **æ ‡å‡†åŒ–é”™è¯¯å¤„ç†**: å»ºç«‹ç»Ÿä¸€æ¡†æ¶ï¼Œæ¶ˆé™¤424ä¸ªç›¸ä¼¼é”™è¯¯å¤„ç†æ¨¡å¼
- **DIå®¹å™¨å¢å¼º**: ç§»é™¤@lru_cacheåŒå¥—ç³»ç»Ÿï¼Œç»Ÿä¸€ä½¿ç”¨ä¾èµ–æ³¨å…¥

### v3.0 - IPCæ¶æ„è¿ç§» (2025-08-06)
**ä»HTTPåˆ°IPCçš„å®Œå…¨è¿ç§»**: é¡¹ç›®å·²å®Œæˆä»FastAPI+HTTPåˆ°çº¯IPC(è¿›ç¨‹é—´é€šä¿¡)æ¶æ„çš„é‡å¤§å‡çº§ï¼Œæ˜¾è‘—æå‡æ€§èƒ½ã€å®‰å…¨æ€§å’Œéƒ¨ç½²ä¾¿åˆ©æ€§ã€‚

## 1. æ¦‚è¿°

Linch Mind Daemon æ˜¯åŸºäºçº¯IPCæ¶æ„æ„å»ºçš„åå°æœåŠ¡ï¼Œè´Ÿè´£æ•°æ®å¤„ç†ã€AIæœåŠ¡é›†æˆå’Œè¿æ¥å™¨ç®¡ç†ã€‚å®ƒé€šè¿‡é«˜æ€§èƒ½IPCé€šä¿¡ä¸ºFlutter UIå’Œè¿æ¥å™¨æä¾›æœåŠ¡ï¼Œå®ç°"éä¾µå…¥å¼ä¸»åŠ¨æ™ºèƒ½"ã€‚

### 1.1. è®¾è®¡åŸåˆ™
- **çº¯IPCé€šä¿¡**: é€šè¿‡Unix Socket (Linux/macOS) å’Œ Named Pipe (Windows) è¿›è¡Œæœ¬åœ°è¿›ç¨‹é—´é€šä¿¡
- **é›¶ç½‘ç»œæš´éœ²**: å®Œå…¨æœ¬åœ°é€šä¿¡ï¼Œæ— ç½‘ç»œå®‰å…¨é£é™©
- **æè‡´æ€§èƒ½**: IPCé€šä¿¡å»¶è¿Ÿ < 1msï¼ŒRPS > 30,000
- **è·¨å¹³å°å…¼å®¹**: ç»Ÿä¸€APIæ¥å£ï¼Œåº•å±‚è‡ªé€‚åº”ä¸åŒæ“ä½œç³»ç»Ÿ
- **å®‰å…¨ä¼˜å…ˆ**: è¿›ç¨‹èº«ä»½éªŒè¯ã€æ–‡ä»¶æƒé™æ§åˆ¶ã€é¢‘ç‡é™åˆ¶
- **å‘åå…¼å®¹**: ç°æœ‰å®¢æˆ·ç«¯ä»£ç æ— éœ€ä¿®æ”¹

## 2. æ ¸å¿ƒèŒè´£
- **IPCæœåŠ¡**: æä¾›é«˜æ€§èƒ½IPCé€šä¿¡æœåŠ¡å¤šå®¢æˆ·ç«¯
- **ç¯å¢ƒç®¡ç†**: å®Œæ•´çš„ç¯å¢ƒéš”ç¦»å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
- **æ•°æ®å¤„ç†**: çŸ¥è¯†å›¾è°±æ„å»ºã€å‘é‡ç´¢å¼•ã€æ™ºèƒ½æ¨è
- **è¿æ¥å™¨ç®¡ç†**: ç®¡ç†å’Œè°ƒåº¦å„ç±»æ•°æ®è¿æ¥å™¨
- **AIæœåŠ¡**: é›†æˆå¤šç§AIæä¾›è€…(OpenAIã€Claudeã€æœ¬åœ°æ¨¡å‹)
- **å®‰å…¨ç®¡ç†**: è¿›ç¨‹èº«ä»½éªŒè¯ã€è®¿é—®æ§åˆ¶ã€é¢‘ç‡é™åˆ¶ã€æ•°æ®åŠ å¯†

## 3. æ¶æ„è¯¦è§£

### 3.1. çº¯IPCæ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å®¢æˆ·ç«¯åº”ç”¨ (Flutter/è¿æ¥å™¨)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       å…¼å®¹å±‚ (HTTP-to-IPCé€‚é…å™¨)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       IPCå®¢æˆ·ç«¯ (IPCClient)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    IPCé€šä¿¡å±‚ (Unix Socket/Named Pipe)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       IPCæœåŠ¡å™¨ (IPCServer)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ä¸­é—´ä»¶ç³»ç»Ÿ (è®¤è¯/æ—¥å¿—/é™æµ)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     è·¯ç”±ç³»ç»Ÿ (IPCApplication/Router)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      ä¸šåŠ¡é€»è¾‘å±‚ (Services/Controllers)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2. æ ¸å¿ƒç»„ä»¶æ¶æ„ (v4.0)

```python
# ç°ä»£åŒ–IPCæ¶æ„ç»„ä»¶ (2025-08-11)
daemon/
â”œâ”€â”€ ipc_main.py             # IPCåº”ç”¨å…¥å£
â”œâ”€â”€ core/                   # ğŸ†• ç°ä»£åŒ–æ ¸å¿ƒæ¶æ„ + ç¯å¢ƒç®¡ç†
â”‚   â”œâ”€â”€ service_facade.py   # ServiceFacade - ç»Ÿä¸€æœåŠ¡è·å–
â”‚   â”œâ”€â”€ error_handling.py   # æ ‡å‡†åŒ–é”™è¯¯å¤„ç†æ¡†æ¶
â”‚   â”œâ”€â”€ container.py        # å¢å¼ºDIå®¹å™¨
â”‚   â”œâ”€â”€ exception_handler.py # å¼‚å¸¸ç®¡ç†å™¨
â”‚   â”œâ”€â”€ environment_manager.py # ç¯å¢ƒç®¡ç†å™¨ - å®Œæ•´ç¯å¢ƒéš”ç¦»
â”‚   â””â”€â”€ database_manager.py # æ•°æ®åº“ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”œâ”€â”€ scripts/                # å·¥å…·è„šæœ¬
â”‚   â””â”€â”€ initialize_environment.py # ç¯å¢ƒåˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ ipc_server.py       # IPCæœåŠ¡å™¨
â”‚   â”œâ”€â”€ ipc_router.py       # è·¯ç”±ç³»ç»Ÿ
â”‚   â”œâ”€â”€ ipc_middleware.py   # ä¸­é—´ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ ipc_routes.py       # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ ipc_security.py     # å®‰å…¨ç®¡ç†
â”‚   â”œâ”€â”€ ipc_client.py       # IPCå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ compatibility_layer.py  # HTTPå…¼å®¹å±‚
â”‚   â””â”€â”€ windows_ipc_server.py   # Windows Named Pipe
â”œâ”€â”€ models/                  # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ database_models.py  # SQLAlchemy ORM
â”‚   â””â”€â”€ api_models.py       # æ•°æ®ä¼ è¾“å¯¹è±¡
â”œâ”€â”€ config/
â”‚   â””â”€â”€ ipc_security_config.py  # IPCå®‰å…¨é…ç½®
â””â”€â”€ tests/
    â”œâ”€â”€ test_ipc_integration.py # IPCé›†æˆæµ‹è¯•
    â””â”€â”€ performance_benchmark.py # æ€§èƒ½åŸºå‡†
```

### 3.3. ç¯å¢ƒéš”ç¦»æ¶æ„ (v5.0æ–°å¢)

#### ç¯å¢ƒç®¡ç†ç³»ç»Ÿ
```python
# âœ… ç¯å¢ƒç®¡ç†å™¨ä½¿ç”¨æ¨¡å¼
from core.service_facade import get_environment_manager
from core.environment_manager import Environment

# ç¯å¢ƒä¿¡æ¯è·å–
env_manager = get_environment_manager()
print(f"å½“å‰ç¯å¢ƒ: {env_manager.current_environment.value}")
print(f"æ•°æ®åº“è·¯å¾„: {env_manager.get_database_url()}")

# ä¸´æ—¶ç¯å¢ƒåˆ‡æ¢
with env_manager.switch_environment(Environment.PRODUCTION):
    # åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰§è¡Œæ“ä½œ
    database_service = get_service(DatabaseService)
    # æ‰€æœ‰æ“ä½œä½¿ç”¨ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“
    pass
```

#### ç¯å¢ƒç›®å½•ç»“æ„
```bash
~/.linch-mind/
â”œâ”€â”€ development/    # å¼€å‘ç¯å¢ƒ - æ— åŠ å¯†ï¼Œè°ƒè¯•æ¨¡å¼
â”‚   â”œâ”€â”€ database/   # SQLiteæ•°æ®åº“æ–‡ä»¶
â”‚   â”œâ”€â”€ config/     # ç¯å¢ƒç‰¹å®šé…ç½®
â”‚   â”œâ”€â”€ logs/       # æ—¥å¿—æ–‡ä»¶
â”‚   â”œâ”€â”€ cache/      # ç¼“å­˜æ•°æ®
â”‚   â””â”€â”€ vectors/    # FAISSå‘é‡ç´¢å¼•
â”œâ”€â”€ staging/        # é¢„å‘ç¯å¢ƒ - SQLCipheråŠ å¯†
â”œâ”€â”€ production/     # ç”Ÿäº§ç¯å¢ƒ - å®Œæ•´åŠ å¯†å’Œä¼˜åŒ–
â””â”€â”€ shared/         # å…±äº«èµ„æº(AIæ¨¡å‹ç­‰)
```

### 3.4. ç°ä»£åŒ–æœåŠ¡æ¶æ„ (v4.0æ–°å¢)

#### ServiceFacadeç»Ÿä¸€æœåŠ¡è·å–
```python
# âœ… ç°ä»£åŒ–æœåŠ¡è·å–æ¨¡å¼
from core.service_facade import get_service, get_connector_manager

# ç»Ÿä¸€facadeæ¨¡å¼ - æ¶ˆé™¤é‡å¤è°ƒç”¨
connector_manager = get_service(ConnectorManager)
database_service = get_service(DatabaseService)

# ä¸“ç”¨å¿«æ·å‡½æ•° - å‘åå…¼å®¹
connector_manager = get_connector_manager()
```

#### æ ‡å‡†åŒ–é”™è¯¯å¤„ç†æ¡†æ¶
```python
# âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†è£…é¥°å™¨ - æ¶ˆé™¤424ä¸ªé‡å¤æ¨¡å¼
from core.error_handling import handle_errors, ErrorSeverity, ErrorCategory

@handle_errors(
    severity=ErrorSeverity.HIGH,
    category=ErrorCategory.CONNECTOR_MANAGEMENT,
    user_message="è¿æ¥å™¨æ“ä½œå¤±è´¥",
    recovery_suggestions="æ£€æŸ¥è¿æ¥å™¨çŠ¶æ€å’Œé…ç½®"
)
async def connector_operation():
    # ä¸šåŠ¡é€»è¾‘ï¼Œå¼‚å¸¸ä¼šè¢«è‡ªåŠ¨æ ‡å‡†åŒ–å¤„ç†
    pass
```

#### DIå®¹å™¨æœåŠ¡ç®¡ç†
```python
# âœ… å¢å¼ºDIå®¹å™¨ - æ›¿ä»£@lru_cacheåŒå¥—ç³»ç»Ÿ
from core.container import get_container

container = get_container()
container.register_service(ConnectorManager, manager_instance)

# æœåŠ¡çŠ¶æ€æ£€æŸ¥å’Œç»Ÿè®¡
if container.is_registered(DatabaseService):
    service = container.get_service(DatabaseService)
```

### 3.4. IPCé€šä¿¡åè®®

IPC æ¶ˆæ¯æ ¼å¼éµå¾ª [IPCåè®®å®Œæ•´è§„èŒƒ (ipc_protocol_specification.md)](ipc_protocol_specification.md) ä¸­å®šä¹‰çš„æ ‡å‡†ã€‚

#### é€šä¿¡æœºåˆ¶
- **æ¶ˆæ¯é•¿åº¦å‰ç¼€**: 4å­—èŠ‚ (big endian)
- **æ¶ˆæ¯ç¼–ç **: UTF-8 JSON
- **è¿æ¥å¤ç”¨**: é•¿è¿æ¥æ”¯æŒå¤šè¯·æ±‚
- **å¼‚æ­¥å¤„ç†**: å®Œå…¨å¼‚æ­¥I/O

### 3.4. è·¨å¹³å°æ”¯æŒ

#### Unixç³»ç»Ÿ (Linux/macOS)
```python
# Unix Domain Socket
socket_path = f"/tmp/linch-mind-{os.getpid()}.sock"
server = await asyncio.start_unix_server(handler, socket_path)
# æ–‡ä»¶æƒé™è®¾ç½®ä¸º600 (ä»…ownerå¯è®¿é—®)
os.chmod(socket_path, 0o600)
```

#### Windowsç³»ç»Ÿ
```python
# Named Pipe
pipe_name = f"linch-mind-{os.getpid()}"
pipe_path = f"\\\\.\\pipe\\{pipe_name}"
# ä½¿ç”¨Windowså®‰å…¨æè¿°ç¬¦æ§åˆ¶è®¿é—®æƒé™
```

### 3.5. æ•°æ®åº“æ¶æ„

- **æ•°æ®åº“**: SQLite + SQLAlchemy ORM
- **è¿æ¥æ± **: æ”¯æŒå¹¶å‘è®¿é—®
- **è¿ç§»**: åŸºäºSQLè„šæœ¬çš„æ•°æ®åº“è¿ç§»
- **æ¨¡å‹**: å›¾èŠ‚ç‚¹ã€å…³ç³»ã€ç”¨æˆ·è¡Œä¸ºç­‰å®Œæ•´æ•°æ®æ¨¡å‹

### 3.6. å®‰å…¨é…ç½®ç®¡ç†

- **IPCå®‰å…¨é…ç½®**: è¿›ç¨‹èº«ä»½éªŒè¯ã€é¢‘ç‡é™åˆ¶ã€è®¿é—®æ§åˆ¶
- **æ–‡ä»¶æƒé™ç®¡ç†**: Socketæ–‡ä»¶æƒé™æ§åˆ¶
- **é…ç½®æ–‡ä»¶**: YAMLæ ¼å¼çš„é…ç½®æ–‡ä»¶
- **ç¯å¢ƒå˜é‡**: æ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–
- **çƒ­é‡è½½**: æ”¯æŒè¿è¡Œæ—¶é…ç½®æ›´æ–°

#### å®‰å…¨é…ç½®ç¤ºä¾‹
```python
# config/ipc_security_config.py
IPC_SECURITY_CONFIG = {
    "authentication": {
        "enabled": True,
        "allowed_processes": {"flutter_ui": True, "connector_*": True}
    },
    "rate_limiting": {
        "enabled": True,
        "max_requests_per_second": 100,
        "burst_limit": 200
    },
    "access_control": {
        "socket_permissions": 0o600,
        "require_same_user": True
    }
}
```

## 4. æ€§èƒ½åŸºå‡†ä¸ä¼˜åŒ–

### 4.1. IPCæ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœ

åŸºäºå®é™…æµ‹è¯•çš„æ€§èƒ½æ•°æ®ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æµ‹è¯•åœºæ™¯       â”‚       RPS       â”‚   å¹³å‡å»¶è¿Ÿ(ms)   â”‚   æˆåŠŸç‡(%)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å•å®¢æˆ·ç«¯åŸºå‡†      â”‚     14,630      â”‚      0.06       â”‚      100        â”‚
â”‚   ä¸­ç­‰å¹¶å‘(10å®¢æˆ·ç«¯) â”‚     30,236      â”‚      0.32       â”‚      100        â”‚
â”‚   é«˜å¹¶å‘(20å®¢æˆ·ç«¯)   â”‚     31,917      â”‚      0.61       â”‚      100        â”‚
â”‚   æé™å‹åŠ›(50å®¢æˆ·ç«¯) â”‚     28,845      â”‚      1.73       â”‚      100        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2. ä¸HTTPæ¶æ„å¯¹æ¯”

| æŒ‡æ ‡é¡¹ | IPCæ¶æ„ | åŸHTTPæ¶æ„ | æå‡å¹…åº¦ |
|--------|---------|------------|----------|
| å¹³å‡å»¶è¿Ÿ | 0.06-0.61ms | 5-15ms | **90%+å‡å°‘** |
| å³°å€¼RPS | 31,917 | 5,000-8,000 | **4xæå‡** |
| å†…å­˜å ç”¨ | 45-60MB | 80-120MB | **30%å‡å°‘** |
| å¯åŠ¨æ—¶é—´ | 0.8s | 2.5s | **68%å‡å°‘** |
| CPUå ç”¨ | 2-5% | 8-15% | **60%å‡å°‘** |

### 4.3. èµ„æºç®¡ç†ä¸æ™ºèƒ½è°ƒåº¦

- **äº‹ä»¶å¤„ç†**: å¯¹æ–‡ä»¶ç³»ç»Ÿå’Œé…ç½®æ–‡ä»¶çš„å˜æ›´äº‹ä»¶ï¼Œé‡‡ç”¨**å»æŠ–åŠ¨ (Debouncing)**æœºåˆ¶ã€‚åœ¨çŸ­æ—¶é—´å†…ï¼ˆå¦‚500msï¼‰å°†å¤§é‡äº‹ä»¶åˆå¹¶ä¸ºå•ä¸ªæ‰¹å¤„ç†ä»»åŠ¡ï¼Œé¿å…CPUå°–å³°ã€‚
- **ä»»åŠ¡è°ƒåº¦**:
    - å†…ç½®ä¸€ä¸ªåŸºäºä¼˜å…ˆçº§çš„ä»»åŠ¡é˜Ÿåˆ—ã€‚
    - å®ç°ä¸€ä¸ª`SystemObserver`ï¼Œç”¨äºç›‘æµ‹CPUè´Ÿè½½ã€å†…å­˜ä½¿ç”¨å’Œç”µæ± çŠ¶æ€ã€‚
    - è°ƒåº¦å™¨æ ¹æ®`SystemObserver`çš„çŠ¶æ€å’Œç”¨æˆ·åœ¨`config.json`ä¸­è®¾å®šçš„æ€§èƒ½æ¨¡å¼ï¼ˆ`eco`, `balanced`, `high_performance`ï¼‰ï¼ŒåŠ¨æ€è°ƒæ•´åå°ä»»åŠ¡çš„å¹¶å‘æ•°å’Œæ‰§è¡Œé¢‘ç‡ã€‚

### 3.5. é”™è¯¯æ¢å¤ä¸æ•°æ®ä¸€è‡´æ€§

- **ä»»åŠ¡æŒä¹…åŒ–**: å¯¹æ¯ä¸ªéœ€è¦å¤„ç†çš„æ–‡ä»¶æˆ–æ•°æ®æºï¼Œåœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªä»»åŠ¡è®°å½•ï¼Œå¹¶ç»´æŠ¤å…¶çŠ¶æ€ï¼ˆ`PENDING`, `PROCESSING`, `DONE`, `FAILED`ï¼‰ã€‚
- **äº‹åŠ¡æ€§æµæ°´çº¿**: ä»æ•°æ®é‡‡é›†åˆ°æœ€ç»ˆå†™å…¥å­˜å‚¨çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œè¢«åŒ…è£¹åœ¨ä¸€ä¸ªå®Œæ•´çš„ä¸šåŠ¡é€»è¾‘äº‹åŠ¡ä¸­ã€‚åªæœ‰æ‰€æœ‰æ­¥éª¤æˆåŠŸï¼Œä»»åŠ¡çŠ¶æ€æ‰è¢«æ ‡è®°ä¸º`DONE`ã€‚ä»»ä½•ä¸€æ­¥å¤±è´¥éƒ½ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šï¼Œå¹¶å°†ä»»åŠ¡æ ‡è®°ä¸º`FAILED`ï¼Œç­‰å¾…åç»­é‡è¯•ã€‚
- **å¯åŠ¨è‡ªæ£€**: Daemonå¯åŠ¨æ—¶ï¼Œä¼šæ‰«æä»»åŠ¡åˆ—è¡¨ï¼Œå¯¹æ‰€æœ‰å¤„äº`PROCESSING`çŠ¶æ€çš„ä»»åŠ¡è¿›è¡Œæ£€æŸ¥å’Œæ¢å¤ï¼Œå¯¹`FAILED`çš„ä»»åŠ¡æ ¹æ®é‡è¯•ç­–ç•¥è¿›è¡Œå¤„ç†ã€‚

## 5. ç”Ÿå‘½å‘¨æœŸä¸éƒ¨ç½²

### 5.1. å¯åŠ¨ä¸å…³é—­æµç¨‹

#### å¯åŠ¨æµç¨‹
```bash
# æ–°çš„IPCå¯åŠ¨å‘½ä»¤
python daemon/ipc_main.py
# æˆ–ä½¿ç”¨é¡¹ç›®è„šæœ¬
./linch
```

#### å¯åŠ¨è¿‡ç¨‹
1. **PIDæ–‡ä»¶ç®¡ç†**: åˆ›å»º`~/.linch-mind/daemon.pid`é˜²æ­¢å¤šå®ä¾‹
2. **Socketåˆ›å»º**: åˆ›å»ºUnix Socketæˆ–Named Pipe
3. **æƒé™è®¾ç½®**: è®¾ç½®Socketæ–‡ä»¶æƒé™(600)
4. **è·¯ç”±æ³¨å†Œ**: åŠ è½½æ‰€æœ‰APIè·¯ç”±
5. **ä¸­é—´ä»¶åˆå§‹åŒ–**: åŠ è½½å®‰å…¨ã€æ—¥å¿—ã€é™æµä¸­é—´ä»¶
6. **æœåŠ¡å‘ç°**: åˆ›å»ºæœåŠ¡å‘ç°æ–‡ä»¶ä¾›å®¢æˆ·ç«¯ä½¿ç”¨

#### å…³é—­æµç¨‹
1. **ä¼˜é›…å…³é—­**: ç­‰å¾…å½“å‰è¯·æ±‚å®Œæˆ
2. **è¿æ¥æ¸…ç†**: å…³é—­æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥
3. **Socketæ¸…ç†**: åˆ é™¤Socketæ–‡ä»¶
4. **PIDæ¸…ç†**: åˆ é™¤PIDæ–‡ä»¶
5. **èµ„æºé‡Šæ”¾**: å…³é—­æ•°æ®åº“è¿æ¥ç­‰èµ„æº

### 5.2. æœåŠ¡å‘ç°æœºåˆ¶

```python
# æœåŠ¡å‘ç°æ–‡ä»¶: ~/.linch-mind/daemon.info
{
    "pid": 12345,
    "socket_path": "/tmp/linch-mind-12345.sock",
    "pipe_name": "linch-mind-12345",  # Windows only
    "version": "3.0.0",
    "started_at": "2025-08-06T10:30:00Z",
    "platform": "darwin"
}
```

### 5.3. å®‰å…¨æ›´æ–°æœºåˆ¶

æ›´æ–°ç¨‹åºé€šè¿‡IPCåè®®å®‰å…¨æ›´æ–°ï¼š
1. **é€šè¿‡IPCè¯·æ±‚å…³é—­**: `POST /admin/shutdown`
2. **ç­‰å¾…ä¼˜é›…å…³é—­**: ç›‘æ§PIDæ–‡ä»¶æ¶ˆå¤±
3. **æ›¿æ¢äºŒè¿›åˆ¶æ–‡ä»¶**: æ›´æ–°daemonæ–‡ä»¶
4. **é‡å¯æœåŠ¡**: å¯åŠ¨æ–°ç‰ˆæœ¬daemon
5. **é…ç½®è¿ç§»**: è‡ªåŠ¨å¤„ç†é…ç½®æ–‡ä»¶ç‰ˆæœ¬å‡çº§

---

## 6. æ¶æ„æœ€ä½³å®è·µä¸è¿ç§»æŒ‡å—

**æ›´æ–°æ—¶é—´**: 2025-08-06
**åŸºäº**: IPCæ¶æ„å®Œå…¨è¿ç§»å’Œæ€§èƒ½ä¼˜åŒ–

### 6.1. IPCæ¶æ„ä¼˜åŠ¿æ€»ç»“

åŸºäºå®Œå…¨è¿ç§»åˆ°IPCæ¶æ„çš„å®è·µç»éªŒï¼š

#### æ ¸å¿ƒä¼˜åŠ¿
- **æè‡´æ€§èƒ½**: å¹³å‡å»¶è¿Ÿä»5-15msé™ä½åˆ°0.06-0.61ms
- **é›¶ç½‘ç»œæš´éœ²**: å®Œå…¨æ¶ˆé™¤ç½‘ç»œå®‰å…¨é£é™©
- **èµ„æºèŠ‚çº¦**: å†…å­˜å ç”¨å‡å°‘30%ï¼ŒCPUå ç”¨å‡å°‘60%
- **éƒ¨ç½²ç®€åŒ–**: æ— ç«¯å£å†²çªï¼Œå¯åŠ¨æ—¶é—´å‡å°‘68%
- **å‘åå…¼å®¹**: ç°æœ‰å®¢æˆ·ç«¯ä»£ç å®Œå…¨ä¸éœ€ä¿®æ”¹

#### æ¶æ„æ¼”è¿›å¯¹æ¯”

**HTTPæ—¶ä»£æ¶æ„** (å·²æ·˜æ±°):
```
UI/è¿æ¥å™¨ â†â†’ HTTP REST API â†â†’ FastAPI â†â†’ Daemonæ ¸å¿ƒ
- é—®é¢˜ï¼šç½‘ç»œå»¶è¿Ÿã€ç«¯å£å†²çªã€å®‰å…¨æš´éœ²ã€èµ„æºæµªè´¹
- æ€§èƒ½ï¼šå»¶è¿Ÿ5-15msï¼ŒRPS 5,000-8,000
```

**IPCæ—¶ä»£æ¶æ„** (å½“å‰):
```
UI/è¿æ¥å™¨ â†â†’ IPCå…¼å®¹å±‚ â†â†’ Unix Socket/Named Pipe â†â†’ Daemonæ ¸å¿ƒ
- ä¼˜åŠ¿ï¼šæœ¬åœ°é€šä¿¡ã€é›¶ç½‘ç»œé£é™©ã€æè‡´æ€§èƒ½ã€è·¨å¹³å°ç»Ÿä¸€
- æ€§èƒ½ï¼šå»¶è¿Ÿ0.06-0.61msï¼ŒRPS 30,000+
```

### 6.2. æ•…éšœæ’é™¤ä¸è°ƒè¯•

#### å¸¸è§é—®é¢˜è¯Šæ–­

**è¿æ¥å¤±è´¥**
```bash
# æ£€æŸ¥daemonæ˜¯å¦è¿è¡Œ
ps aux | grep ipc_main
cat ~/.linch-mind/daemon.pid

# æ£€æŸ¥Socketæ–‡ä»¶
ls -la /tmp/linch-mind-*.sock
stat /tmp/linch-mind-*.sock
```

**æƒé™é”™è¯¯**
```bash
# æ£€æŸ¥Socketæƒé™
ls -la /tmp/linch-mind-*.sock
# åº”æ˜¾ç¤º: srw------- 1 user user 0 Aug  6 10:30 linch-mind-12345.sock

# ä¿®å¤æƒé™é—®é¢˜
chmod 600 /tmp/linch-mind-*.sock
```

**æ€§èƒ½é—®é¢˜**
```python
# å¯ç”¨æ€§èƒ½è°ƒè¯•
import logging
logging.getLogger("ipc").setLevel(logging.DEBUG)

# è¿è¡Œæ€§èƒ½åŸºå‡†
python daemon/tests/performance_benchmark.py
```

### 6.3. å¼€å‘è€…æŒ‡å—

#### æ·»åŠ æ–°çš„IPCè·¯ç”±
```python
# åœ¨ daemon/services/ipc_routes.py ä¸­æ·»åŠ 
@router.get("/new-endpoint/{param}")
async def handle_new_endpoint(request: IPCRequest) -> IPCResponse:
    param = request.path_params.get("param")
    # å¤„ç†é€»è¾‘
    return IPCResponse(
        status_code=200,
        data={"result": f"Processed {param}"}
    )
```

#### æ·»åŠ æ–°çš„ä¸­é—´ä»¶
```python
# åœ¨ daemon/services/ipc_middleware.py ä¸­æ·»åŠ 
async def custom_middleware(request: IPCRequest, call_next: Callable) -> IPCResponse:
    # å‰ç½®å¤„ç†
    start_time = time.time()

    # è°ƒç”¨ä¸‹ä¸€å±‚
    response = await call_next()

    # åç½®å¤„ç†
    duration = time.time() - start_time
    logger.info(f"Request processed in {duration:.3f}s")

    return response
```

## 7. ç›¸å…³æ–‡æ¡£

- [çº¯IPCæ¶æ„è®¾è®¡æŒ‡å—](../../Pure_IPC_Architecture_Guide.md) - è¯¦ç»†æŠ€æœ¯å®ç°
- [IPCå®‰å…¨æ¶æ„è®¾è®¡](security_architecture_design.md) - å®‰å…¨é…ç½®å’Œæœ€ä½³å®è·µ
- [è¿æ¥å™¨å¼€å‘æ ‡å‡†](connector_internal_management_standards.md) - è¿æ¥å™¨å¼€å‘æŒ‡å—
- [APIå¥‘çº¦è®¾è®¡](api_contract_design.md) - IPCæ¶ˆæ¯åè®®è§„èŒƒ
- [Python + Flutteræœ€ç»ˆæ¶æ„å†³ç­–](../02_decisions/python_flutter_architecture_final_decision.md) - æŠ€æœ¯æ¶æ„é€‰æ‹©å†³ç­–

## 8. æ€»ç»“

**IPCæ¶æ„è¿ç§»æˆåŠŸ**: Linch Mindå·²å®Œæˆä»HTTPåˆ°çº¯IPCçš„é‡å¤§æ¶æ„å‡çº§ï¼Œå®ç°äº†ï¼š

- âœ… **æ€§èƒ½çªç ´**: å»¶è¿Ÿå‡å°‘90%+ï¼Œååé‡æå‡4å€
- âœ… **å®‰å…¨å¢å¼º**: é›¶ç½‘ç»œæš´éœ²ï¼Œè¿›ç¨‹çº§èº«ä»½éªŒè¯
- âœ… **èµ„æºä¼˜åŒ–**: CPUå’Œå†…å­˜å ç”¨æ˜¾è‘—é™ä½
- âœ… **éƒ¨ç½²ç®€åŒ–**: æ— ç«¯å£å†²çªï¼Œå¯åŠ¨æ›´å¿«
- âœ… **å‘åå…¼å®¹**: ç°æœ‰å®¢æˆ·ç«¯æ— éœ€ä¿®æ”¹
- âœ… **è·¨å¹³å°ç»Ÿä¸€**: Unix Socket + Named Pipeå®Œæ•´æ”¯æŒ

è¿™æ ‡å¿—ç€é¡¹ç›®æŠ€æœ¯æ¶æ„è¿›å…¥æ–°æ—¶ä»£ï¼Œä¸ºåç»­AIåŠŸèƒ½å¢å¼ºå’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–å¥ å®šäº†åšå®åŸºç¡€ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: 4.0
**åˆ›å»ºæ—¶é—´**: 2025-08-03
**æœ€æ–°æ›´æ–°**: 2025-08-08
**é‡å¤§æ›´æ–°**: P0ä»£ç é‡å¤æ¶ˆé™¤é‡æ„å®Œæˆï¼Œç°ä»£åŒ–æœåŠ¡æ¶æ„
**ç»´æŠ¤å›¢é˜Ÿ**: æ¶æ„ç»„ + IPCä¸“é¡¹ç»„ + ä»£ç è´¨é‡å›¢é˜Ÿ
