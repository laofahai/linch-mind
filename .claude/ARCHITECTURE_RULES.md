# Linch Mind 架构规则

## 🏗️ 架构决策流程

### 何时必须使用Sub-agents

#### 🔴 强制咨询 core-development-architect
触发条件（满足任一即触发）：
- 新增顶层模块或服务（src/commonMain/kotlin/tech/linch/mind/*/）
- 修改超过3个文件的重构
- 改变核心数据流（例如：修改AppScope、DaemonClient、BFF接口）
- 引入新的第三方依赖（build.gradle.kts修改）
- 修改数据持久化schema

示例提示词：
```
我需要[具体描述改动]，这会影响[受影响的模块]。
请分析架构影响并提供实现建议。
```

#### 🔴 强制咨询 project-docs-manager
触发条件：
- 任何架构决策后的文档更新
- 新功能实现完成后
- 重大bug修复后
- API接口变更

### 架构健康指标
- 模块耦合度：每个模块最多依赖3个其他模块
- 文件大小：单文件不超过500行
- 函数复杂度：圈复杂度不超过10
- 测试覆盖：核心功能测试覆盖率>80%

## 🚫 禁止事项
1. 不得在UI层直接访问数据库
2. 不得绕过BFF直接调用后端服务
3. 不得在没有缓存的情况下重复调用AI服务
4. 不得将敏感信息硬编码

## ✅ 推荐实践
1. 使用依赖注入而非硬编码依赖
2. 优先使用现有组件而非创建新组件
3. 每个新功能都应有对应的日志记录
4. 复杂操作必须有进度反馈